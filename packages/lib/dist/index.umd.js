!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("react"),require("prop-types"),require("fastdom/extensions/fastdom-promised"),require("fastdom")):"function"==typeof define&&define.amd?define(["exports","react","prop-types","fastdom/extensions/fastdom-promised","fastdom"],t):t(e["react-unlimited"]={},e.React,e.PropTypes,e.fastdomPromised,e.fastdom)}(this,function(e,t,r,n,o){"use strict";var i="default"in t?t.default:t;r=r&&r.hasOwnProperty("default")?r.default:r,n=n&&n.hasOwnProperty("default")?n.default:n,o=o&&o.hasOwnProperty("default")?o.default:o;var s=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},l=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},c=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},u=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},d=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments[1];return[].concat(function(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}(Array(t-e).keys())).map(function(t){return t+e})},p=function(e){function t(){var e,r,n;s(this,t);for(var o=arguments.length,i=Array(o),l=0;l<o;l++)i[l]=arguments[l];return r=n=u(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(i))),n.handleRenderRow=function(e){var t=n.props,r=t.renderRow,o=t.rowHeight;return r({index:e,style:{position:"absolute",width:"100%",height:o+"px",willChange:"transform",transform:"translate3d(0, "+e*o+"px, 0)",boxSizing:"border-box"},isScrolling:t.isScrolling})},n.renderList=function(){var e=n.props,t=e.startIndex,r=e.endIndex;return-1===t||-1===r?null:d(t,r+1).map(n.handleRenderRow)},u(n,r)}return c(t,e),l(t,[{key:"render",value:function(){var e=this.props,t=e.forwardedRef,r=e.height,n=e.width,o=e.isScrolling,s=e.className;return i.createElement("div",{ref:t,className:s,style:{position:"relative",overflow:"hidden",width:"auto",maxWidth:n+"px",height:r+"px",maxHeight:r+"px",boxSizing:"border-box",pointerEvents:o?"none":""}},this.renderList())}}]),t}(t.Component);p.propTypes={forwardedRef:r.any.isRequired,startIndex:r.number.isRequired,endIndex:r.number.isRequired,height:r.number.isRequired,width:r.number.isRequired,rowHeight:r.number.isRequired,renderRow:r.func.isRequired,isScrolling:r.bool,className:r.string},p.defaultProps={isScrolling:!1,className:void 0};var f=i.forwardRef(function(e,t){return i.createElement(p,a({},e,{forwardedRef:t}))}),h=o.extend(n),m=function(e){function t(){var e,r,n;s(this,t);for(var o=arguments.length,l=Array(o),a=0;a<o;a++)l[a]=arguments[a];return r=n=u(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(l))),n.wrapper=i.createRef(),n.isScrollingTimeout=null,n.state={startIndex:-1,endIndex:-1,height:0,width:0,lastScrollTop:0,lastScrollTime:Date.now(),isScrolling:!1},n.getScrollingData=function(){return h.measure(function(){var e=n.props.scrollerRef,t=n.wrapper.current;return e instanceof Window?{wrapperTop:t.offsetTop,scrollTop:e.scrollY,scrollHeight:e.innerHeight,scrollWidth:e.innerWidth}:{wrapperTop:t.offsetTop-e.offsetTop,scrollTop:e.scrollTop,scrollHeight:e.clientHeight,scrollWidth:e.clientWidth}})},n.getIndexPosition=function(e){return n.getScrollingData().then(function(t){var r=t.wrapperTop,o=n.props,i=o.rowHeight,s=o.length;return e<0?r:e>=s?(s-1)*i+r:e*i+r})},n.addListeners=function(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:n.props).scrollerRef;n.scrollTicking=!1,e&&e.addEventListener("scroll",n.scrollListener),n.resizeTicking=!1,window.addEventListener("resize",n.resizeListener)},n.removeListeners=function(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:n.props).scrollerRef;e&&e.removeEventListener("scroll",n.scrollListener),window.removeEventListener("resize",n.resizeListener),n.scrollRAF&&cancelAnimationFrame(n.scrollRAF),n.resizeRAF&&cancelAnimationFrame(n.resizeRAF)},n.scrollToIndex=function(e){var t=n.props.scrollerRef;n.getIndexPosition(e).then(function(e){t instanceof Window?setTimeout(function(){return t.scrollTo(0,e)}):h.mutate(function(){t.scrollTop=e})})},n.scrollListener=function(){n.scrollTicking||(n.scrollRAF=window.requestAnimationFrame(function(){n.updateList(),n.scrollTicking=!1})),n.scrollTicking=!0},n.resizeListener=function(){n.resizeTicking||(n.resizeRAF=window.requestAnimationFrame(function(){n.updateList(),n.updateDimensions(),n.resizeTicking=!1})),n.resizeTicking=!0},n.computePosition=function(){return n.getScrollingData().then(function(e){var t=e.scrollTop,r=e.scrollHeight,o=e.scrollWidth,i=e.wrapperTop,s=n.props,l=s.length,a=s.overscan,c=s.rowHeight,u=n.state,d=u.lastScrollTop,p=u.lastScrollTime,f=Math.floor((t-i)/c),h=f+Math.floor(r/c),m=Math.min(1,(Date.now()-p)/16),g=Math.min(r,t-d),v=Math.floor(g*m/c),w=a,y=a;return v<0?w=a+Math.abs(v):v>0&&(y=a+Math.abs(v)),{startIndex:f-w>=0?f-w:0,endIndex:h+y<l?h+y:l-1,height:c*l,width:o,scrollTop:t}})},n.updateDimensions=function(){return n.computePosition().then(function(e){var t=e.height,r=e.width;return n.setState({height:t,width:r})})},n.updateList=function(){var e=n.props,t=e.length,r=e.onLoadMore,o=e.overscan;n.computePosition().then(function(e){var i=e.startIndex,s=e.endIndex,l=e.scrollTop;r&&s+o>=t&&r(),n.setState(function(){return{startIndex:i,endIndex:s,lastScrollTop:l,lastScrollTime:Date.now(),isScrolling:!0}},n.resetIsScrollingDebounced)})},n.resetIsScrollingDebounced=function(){n.isScrollingTimeout&&clearTimeout(n.isScrollingTimeout),n.isScrollingTimeout=setTimeout(n.resetIsScrolling,150)},n.resetIsScrolling=function(){n.isScrollingTimeout=null,n.setState({isScrolling:!1})},n.renderList=function(e){var t=n.props,r=t.renderRow,o=t.rowHeight,s=n.state,l=s.startIndex,a=s.endIndex,c=s.width,u=s.height,d=s.isScrolling;return i.createElement(f,{ref:n.wrapper,startIndex:l,endIndex:a,height:u,width:c,isScrolling:d,rowHeight:o,renderRow:r,className:e})},u(n,r)}return c(t,e),l(t,[{key:"componentDidMount",value:function(){var e=this.props,t=e.scrollerRef,r=e.scrollToIndex;t&&(this.addListeners(),this.updateDimensions(),r?this.scrollToIndex(r):this.updateList())}},{key:"componentDidUpdate",value:function(e){var t=this.props,r=t.scrollerRef,n=t.scrollToIndex,o=t.length;r&&r!==e.scrollerRef&&(this.removeListeners(e),this.addListeners(),this.updateList(),this.updateDimensions()),o!==e.length&&(this.updateList(),this.updateDimensions()),n&&n!==e.scrollToIndex&&this.scrollToIndex(n)}},{key:"componentWillUnmount",value:function(){this.removeListeners(),this.isScrollingTimeout&&clearTimeout(this.isScrollingTimeout)}},{key:"render",value:function(){var e=this.props.className;return this.renderList(e)}}]),t}(t.Component);m.propTypes={length:r.number.isRequired,rowHeight:r.number.isRequired,renderRow:r.func.isRequired,scrollerRef:r.any,overscan:r.number,scrollToIndex:r.number,onLoadMore:r.func,className:r.string},m.defaultProps={scrollerRef:void 0,overscan:10,scrollToIndex:void 0,onLoadMore:void 0,className:void 0};var g=function(e){function t(){var e,r,n;s(this,t);for(var o=arguments.length,i=Array(o),l=0;l<o;l++)i[l]=arguments[l];return r=n=u(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(i))),n.state={ref:void 0},n.setRef=function(e){return n.setState({ref:e})},u(n,r)}return c(t,e),l(t,[{key:"render",value:function(){var e=this.props,t=e.height,r=e.width,n=e.className,o=function(e,t){var r={};for(var n in e)t.indexOf(n)>=0||Object.prototype.hasOwnProperty.call(e,n)&&(r[n]=e[n]);return r}(e,["height","width","className"]),s=this.state.ref;return i.createElement("div",{ref:this.setRef,className:n,style:{height:t,width:r,overflow:"auto",willChange:"scroll-position"}},i.createElement(m,a({scrollerRef:s},o)))}}]),t}(t.Component);g.propTypes={height:r.number.isRequired,width:r.number.isRequired,className:r.string},g.defaultProps={className:void 0},e.UnlimitedList=m,e.UnlimitedSizedList=g,Object.defineProperty(e,"__esModule",{value:!0})});
